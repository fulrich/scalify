<html><head><title>Scalify: Scalify</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="fulrich" /><meta name="description" content="Build Shopify Apps using Scala" /><meta name="og:image" content="/scalify/img/poster.png" /><meta name="image" property="og:image" content="/scalify/img/poster.png" /><meta name="og:title" content="Scalify: Scalify" /><meta name="title" property="og:title" content="Scalify: Scalify" /><meta name="og:site_name" content="Scalify" /><meta name="og:url" content="https://fulrich.github.io/scalify/" /><meta name="og:type" content="website" /><meta name="og:description" content="Build Shopify Apps using Scala" /><link rel="icon" type="image/png" href="/scalify/img/favicon.png" /><meta name="twitter:title" content="Scalify: Scalify" /><meta name="twitter:image" content="/scalify/img/poster.png" /><meta name="twitter:description" content="Build Shopify Apps using Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scalify/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalify/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalify/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalify/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalify/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalify/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalify/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalify/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalify/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalify/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalify/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalify/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalify/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalify/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalify/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalify/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalify/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalify/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalify/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalify/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalify/highlight/styles/darcula.css" /><link rel="stylesheet" href="/scalify/css/style.css" /><link rel="stylesheet" href="/scalify/css/palette.css" /><link rel="stylesheet" href="/scalify/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/scalify/" class="brand"><div class="brand-wrapper"><span>Scalify</span></div></a></li> <li><a href="/scalify/docs/index.html" class="">Getting Started</a></li> <li><a href="/scalify/docs/core/index.html" class=" active ">Scalify</a></li> <li><a href="/scalify/docs/plus/index.html" class="">Plus</a> <ul class="sub_section"> <li><a href="/scalify/docs/plus/play.html" class="">Play</a></li> <li><a href="/scalify/docs/plus/sbt-play.html" class="">SBT Play</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/fulrich/scalify"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/fulrich/scalify"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="fulrich" data-github-repo="scalify"><div class="content-wrapper"><section><h2 id="scalify">Scalify</h2>
<h3 id="overview">Overview</h3>
<p>The main Scalify library contains all the core logic required to build a Shopify App.
The core of Scalify is meant to be framework agnostics. 
The goal is for you to be able to use it with any framework you prefer.
To this end we try to avoid making a lot of decision within the library and instead try to provide constructs to make your developing easier.</p>

<h3 id="configuration">Configuration</h3>
<p>At the core of the Scalify library is the ShopifyConfiguration object. 
This is required for all of the communication to and from Shopify to function.
As stated in our overview we attempt to make no decision for how you will get this data into your application so it is up to you to create the ShopifyConfiguration construct when needed.</p>

<h3 id="hmac-validation">HMAC Validation</h3>
<p>Shopify’s API will always contain an HMAC parameter that can be used to verify requests from Shopify.
You can read more about this HMAC verification <a href="https://help.shopify.com/en/api/getting-started/authentication/oauth#verification">here</a>.
Scalify gives you a few ways to easily handle this verification step.</p>

<h4 id="simple-raw-verification">Simple Raw Verification</h4>
<p>This step requires the most work from the developers standpoint but offers maximum flexibility.
In this case you provide the HMAC value and the payload you wish to validate.
You are responsible for sorting the payload into the proper order per Shopify’s <a href="https://help.shopify.com/en/api/getting-started/authentication/oauth#verification">documentation</a>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.ShopifyConfiguration</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.hmac.ShopifyHmac</span>

<span class="k">object</span> <span class="nc">ExampleRawVerification</span> <span class="o">{</span>
  <span class="c1">// You can pass the configuration directly but Scalify has it as an implicit parameter in most circumstances
</span>  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">configuration</span><span class="k">:</span> <span class="kt">ShopifyConfiguration</span> <span class="o">=</span> <span class="nv">MyConfigurationStore</span><span class="o">.</span><span class="py">get</span>
  
  <span class="k">def</span> <span class="nf">handleValidation</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// You must extract the HMAC Value
</span>    <span class="k">val</span> <span class="nv">hmacValue</span> <span class="k">=</span> <span class="nf">extractHmac</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span>
    <span class="c1">// You must sort the payload 
</span>    <span class="k">val</span> <span class="nv">sortedPayload</span> <span class="k">=</span> <span class="nf">sortPayload</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span>

    <span class="c1">// Now you can use Scalify's helper to validate your HMAC
</span>    <span class="nv">ShopifyHmac</span><span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="n">hmac</span><span class="o">,</span> <span class="n">payload</span><span class="o">)</span>
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="nf">extractHmac</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="nf">sortPayload</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="structured-raw-verification">Structured Raw Verification</h4>
<p>The simple ShopifyHmac validator only returns a boolean value. 
Sometimes you may need a more useful construct for passing around HMAC validation and Scalify provides that using our Hmac monad.
An example of that usage is seen below:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.ShopifyConfiguration</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.hmac.</span><span class="o">{</span><span class="nc">Hmac</span><span class="o">,</span> <span class="nc">Invalid</span><span class="o">,</span> <span class="nc">Valid</span><span class="o">}</span>

<span class="k">object</span> <span class="nc">ExampleStructuredRawVerification</span> <span class="o">{</span>
  <span class="c1">// You can pass the configuration directly but Scalify has it as an implicit parameter in most circumstances
</span>  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">configuration</span><span class="k">:</span> <span class="kt">ShopifyConfiguration</span> <span class="o">=</span> <span class="nv">MyConfigurationStore</span><span class="o">.</span><span class="py">get</span>
  
  <span class="k">def</span> <span class="nf">handleValidation</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// You must extract the HMAC Value
</span>    <span class="k">val</span> <span class="nv">hmacValue</span> <span class="k">=</span> <span class="nf">extractHmac</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span>
    <span class="c1">// You must sort the payload 
</span>    <span class="k">val</span> <span class="nv">sortedPayload</span> <span class="k">=</span> <span class="nf">sortPayload</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span>

    <span class="nc">Hmac</span><span class="o">(</span><span class="n">hmac</span><span class="o">,</span> <span class="n">payload</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Valid</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"Validated HMAC for payload: $payload"</span>
      <span class="k">case</span> <span class="nc">Invalid</span> <span class="k">=&gt;</span> <span class="s">"Invalid HMAC was provided."</span>
    <span class="o">}</span> 
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="nf">extractHmac</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="nf">sortPayload</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="using-scala-uri">Using Scala URI</h4>
<p>Scalify also offers a bit more help with your HMAC verification if you prefer.
Scalify uses the fantastic <a href="https://github.com/lemonlabsuk/scala-uri">Scala URI library</a> which is a lightweight Scala library for building and parsing URIs.
If you choose this route Scalify will handle extracting the HMAC value as well as ensuring the payload is sorted:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.ShopifyConfiguration</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.hmac.ShopifyHmac</span>

<span class="k">object</span> <span class="nc">ExampleScalaUriVerification</span> <span class="o">{</span>
  <span class="c1">// You can pass the configuration directly but Scalify has it as an implicit parameter in most circumstances
</span>  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">configuration</span><span class="k">:</span> <span class="kt">ShopifyConfiguration</span> <span class="o">=</span> <span class="nv">MyConfigurationStore</span><span class="o">.</span><span class="py">get</span>
  
  <span class="k">def</span> <span class="nf">handleValidation</span><span class="o">(</span><span class="n">payload</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Hmac</span><span class="o">[</span><span class="kt">QueryString</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="c1">// There are many ways to create a Scala URI Query String, use the method that works best for your case
</span>    <span class="k">val</span> <span class="nv">scalaUriQueryString</span> <span class="k">=</span> <span class="nv">QueryString</span><span class="o">.</span><span class="py">parse</span><span class="o">(</span><span class="n">payload</span><span class="o">)</span>
    
    <span class="c1">// Now you can validate the HMAC
</span>    <span class="nv">ShopifyHmac</span><span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="n">scalaUriQueryString</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The QueryString HMAC validation provides you with the structured HMAC monad so you can provide meaningful error responses:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.ShopifyConfiguration</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.hmac.ShopifyHmac</span>

<span class="k">object</span> <span class="nc">ExampleHmacResponses</span> <span class="o">{</span>  
  <span class="k">def</span> <span class="nf">hmacResponse</span><span class="o">(</span><span class="n">hmac</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Hmac</span><span class="o">[</span><span class="kt">QueryString</span><span class="o">]])</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">hmac</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Valid</span><span class="o">(</span><span class="n">queryString</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"HMAC validation succeeded for: $queryString"</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Invalid</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"HMAC validation failed."</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"No HMAC parameter was provided."</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="uri-bindings">URI Bindings</h3>
<p>Most Frameworks offer a way to parse URI values and bind them to concrete Scala classes.
Scalify provides you with the concrete Scala classes and you can use your framework’s preferred binding method.
However it also offers it’s own binding system that works with the <a href="https://github.com/lemonlabsuk/scala-uri">Scala URI library</a>.
Feel free to use this instead of your framework’s binding:</p>

<h4 id="bind">Bind</h4>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.installation.InstallParameters</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.serialization.url._</span>
<span class="k">import</span> <span class="nn">org.scalactic._</span>

<span class="k">object</span> <span class="nc">ScalifyUriBindingExample</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">installRoute</span><span class="o">(</span><span class="n">uri</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">bind</span><span class="o">[</span><span class="kt">InstallParameters</span><span class="o">](</span><span class="n">uri</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Good</span><span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"A parsed InstallParameters case class $parameters"</span>
      <span class="k">case</span> <span class="nc">Bad</span><span class="o">(</span><span class="n">errors</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"A Seq of all the parsing errors that occurred: $errors"</span>
    <span class="o">}</span> 
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You will notice two new constructs we haven’t discussed yet: <code class="highlighter-rouge">Good</code> and <code class="highlighter-rouge">Bad</code>. 
These come from the amazing <a href="http://www.scalactic.org/">Scalactic library</a>.
Specifically these are part of the <a href="http://www.scalactic.org/user_guide/OrAndEvery">Scalactic Or</a>. 
Scalify uses this to handle error responses as it allows us to collect all errors that occurred during a process which then allows you to provide more comprehensive error responses.</p>

<p>In the example above we used a straight URI string and allowed the Scala URI library to parse it.
Scalify offers other ways to handle bindings and the full interface is below:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Bindings</span> <span class="o">{</span>
  <span class="c1">// Optionally bind on a full URI String
</span>  <span class="k">def</span> <span class="nf">optionalBind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">uri</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span>

  <span class="c1">// Optionally bind on a QueryString object from Scala URI
</span>  <span class="k">def</span> <span class="nf">optionalBind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">query</span><span class="k">:</span> <span class="kt">QueryString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span>
  
  <span class="c1">// Optionally bind on a Scala representation of Query Parameters: Map[String, Seq[String]]
</span>  <span class="k">def</span> <span class="nf">optionalBind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">queryMap</span><span class="k">:</span> <span class="kt">QueryMap</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span>


  <span class="c1">// Bind on a full URI String
</span>  <span class="k">def</span> <span class="nf">bind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">uri</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>

  <span class="c1">// Bind on a QueryString object from Scala URI
</span>  <span class="k">def</span> <span class="nf">bind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">query</span><span class="k">:</span> <span class="kt">QueryString</span><span class="o">)</span><span class="k">:</span> <span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>

  <span class="c1">// Bind on a Scala representation of Query Parameters: Map[String, Seq[String]]
</span>  <span class="k">def</span> <span class="nf">bind</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">queryMap</span><span class="k">:</span> <span class="kt">QueryMap</span><span class="o">)</span><span class="k">:</span> <span class="kt">UrlBind</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="unbind">Unbind</h4>
<p>If you need to call back to Shopify with parameters Scalify also offers an unbind method (also useful for testing).
If you have a constructed object you can call unbind to create a ScalaUri QueryString of the URI parameters</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.fulrich.scalify.installation.InstallParameters</span>
<span class="k">import</span> <span class="nn">com.github.fulrich.scalify.serialization.url._</span>

<span class="k">object</span> <span class="nc">UnbindExample</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">installParameters</span> <span class="k">=</span> <span class="nc">InstallParameters</span><span class="o">(</span><span class="n">shop</span> <span class="k">=</span> <span class="s">"test.myshopify.com"</span><span class="o">,</span> <span class="n">timestamp</span> <span class="k">=</span> <span class="nv">Instant</span><span class="o">.</span><span class="py">now</span><span class="o">)</span>
  
  <span class="c1">// Returns a QueryString of the InstallParameters object
</span>  <span class="nf">unbind</span><span class="o">(</span><span class="n">installParameters</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scalify/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/scalify/js/main.js"></script></body></html>